---
apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: validate-task
spec:
  inputs:
    params:
    - name: task-pvc
      description: pipeline pvc name place holder
    - name: registry-namespace
      description: The namespace in the container image registry. You can set it up
        with {ic cr namespace-add]. Learn more at https://cloud.ibm.com/docs/services/Registry?topic=registry-getting-started#getting-started.
    - name: repo
      description: GIT_REPO
    - name: repository
      description: The git repo
    - name: app-name
      description: The name of your app
    - name: revision
      description: the branch for the git repo
    - name: registry-region
      description: The IBM Cloud region for image registry
    - name: api-key
      description: The IBM Cloud API key is used to access the IBM Cloud Kubernetes
        Service API and interact with the cluster. You can obtain your API key with
        'bx iam api-key-create' or via the console at https://cloud.ibm.com/iam#/apikeys
        by clicking **Create API key** (Each API key only can be viewed once).
  steps:
  - name: secrets-detection-placeholder
    image: ibmcom/pipeline-base-image:latest
    env:
    - name: REGISTRY_REGION_ID
      value: $(inputs.params.registry-region)
    - name: APP_NAME
      value: $(inputs.params.app-name)
    - name: REGISTRY_NAMESPACE
      value: $(inputs.params.registry-namespace)
    - name: GIT_REPO
      value: $(inputs.params.repo)
    - name: API_KEY
      value: $(inputs.params.api-key)
    command: ["/bin/bash", "-c"]
    args:
    - |
      #!/bin/bash
      echo "RUNNING"
    volumeMounts:
    - mountPath: /artifacts
      name: task-volume
  - name: oss-licence-check-placeholder
    image: ibmcom/pipeline-base-image:latest
    env:
    - name: REPOSITORY
      value: $(inputs.params.repository)
    - name: REVISION
      value: $(inputs.params.revision)
    command: ["/bin/sh", "-c"]
    args:
    - |
      #!/bin/bash
      echo "RUNNING oss licence check"
  - name: cis-benchmarks-placeholder
    image: ibmcom/pipeline-base-image:latest
    env:
    - name: REPOSITORY
      value: $(inputs.params.repository)
    - name: REVISION
      value: $(inputs.params.revision)
    command: ["/bin/sh", "-c"]
    args:
    - |
      #!/bin/bash
      echo "RUNNING CIS bench marks"
  - name: additional-image-checks-placeholder
    image: ibmcom/pipeline-base-image:latest
    env:
    - name: REGISTRY_REGION_ID
      value: $(inputs.params.registry-region)
    - name: APP_NAME
      value: $(inputs.params.app-name)
    - name: REGISTRY_NAMESPACE
      value: $(inputs.params.registry-namespace)
    - name: GIT_REPO
      value: $(inputs.params.repo)
    - name: API_KEY
      value: $(inputs.params.api-key)
    command: ["/bin/bash", "-c"]
    args:
    - |
      #!/bin/bash
      echo "RUNNING"
    volumeMounts:
    - mountPath: /artifacts
      name: task-volume
  volumes:
  - name: task-volume
    persistentVolumeClaim:
      claimName: $(inputs.params.task-pvc)
